<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å®¶ç”¨é»æ•¸ä»»å‹™æ¿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: #f5f5f7; }

    /* è®“æ•´é«”å­—å¤§ä¸€é»ï¼Œé©åˆå°å­©æ‰‹æŒ‡ + è¦–åŠ› */
    body { font-size: 18px; }

    .app {
      max-width: 480px;
      margin: 16px auto;
      background: white;
      border-radius: 24px;
      box-shadow: 0 0 12px rgba(0,0,0,0.12);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 88vh;
    }

    /* ç”·å­© / å¥³å­© ä¸»é¡Œè‰² */
    .app.boy header {
      background: linear-gradient(135deg,#4f8cf7,#7ab8ff);
    }
    .app.girl header {
      background: linear-gradient(135deg,#ff7eb3,#ff9a9e);
    }

    header {
      color: white;
      padding: 18px 18px 14px;
    }
    .header-top { display:flex; justify-content:space-between; align-items:center; }
    .kid-main { display:flex; align-items:center; gap:10px; }
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #ffdd66;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 700;
      font-size: 22px;
    }
    .kid-name { font-size: 22px; font-weight: 700; }
    .kid-sub { font-size: 14px; opacity: 0.95; }
    .switch-btn {
      border: none;
      background: rgba(255,255,255,0.25);
      color: white;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
    }
    .header-bottom {
      margin-top: 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 8px;
    }
    .date-chip {
      background: rgba(255,255,255,0.2);
      padding: 6px 10px;
      border-radius: 999px;
      white-space: nowrap;
      font-size: 14px;
    }
    .total-points {
      font-size: 26px;
      font-weight: 800;
      display:flex;
      align-items:center;
      gap: 6px;
      white-space: nowrap;
    }

    main {
      padding: 10px 16px 12px;
      flex: 1;
      overflow-y: auto;
    }
    h2 {
      font-size: 18px;
      margin: 10px 0 6px;
    }
    .card {
      background:#fff;
      border-radius:16px;
      padding:14px;
      margin-bottom:12px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
    }

    /* Firebase åŒæ­¥ç‹€æ…‹åˆ— */
    .sync-bar {
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 999px;
      display:inline-flex;
      align-items:center;
      gap: 6px;
      margin-bottom: 10px;
    }
    .sync-bar.synced {
      background:#e8f5e9;
      color:#2e7d32;
    }
    .sync-bar.syncing {
      background:#fff8e1;
      color:#f57f17;
    }
    .sync-bar.error {
      background:#ffebee;
      color:#c62828;
    }

    /* é€±ä»»å‹™è¡¨ */
    .week-wrapper {
      overflow-x:auto;
      padding-bottom: 6px;
      position: relative;
      scroll-behavior:smooth;
    }
    .week-table {
      min-width: 640px; /* è®“æ‰‹æ©Ÿå¯ä»¥å·¦å³æ‹–å‹• */
      border-radius: 16px;
      background:#fff;
      box-shadow:0 2px 4px rgba(0,0,0,0.04);
      padding:10px;
    }
    .week-header,
    .task-row,
    .day-summary-row {
      display:flex;
      align-items:center;
      gap: 6px;
      font-size: 14px;
    }
    .week-header {
      font-weight:700;
      margin-bottom:6px;
    }
    .task-name-header,
    .task-name,
    .task-name-summary {
      flex:0 0 120px;
      min-width:120px;
      font-size:14px;
      font-weight:600;
    }
    /* å‡çµåœ¨å·¦é‚Šçš„ä»»å‹™åç¨± */
    .task-name,
    .task-name-summary {
      position: sticky;
      left: 0;
      background:#fff;
      z-index:1;
    }
    .day-header,
    .day-cell,
    .day-summary-cell {
      flex:1;
      text-align:center;
    }
    .day-cell input {
      width: 30px;
      height: 30px;
      cursor:pointer;
    }
    .task-row {
      margin-bottom:6px;
    }
    .day-summary-row {
      margin-top:4px;
      padding-top:4px;
      border-top:1px dashed #eee;
      font-size:13px;
      color:#555;
    }
    .day-summary-cell-positive { color:#2e7d32; font-weight:600; }
    .day-summary-cell-negative { color:#c62828; font-weight:600; }
    .today-col { background:#e3f2fd; border-radius:8px; }

    /* History */
    .history-item { display:flex; justify-content:space-between; margin-bottom:10px; font-size: 15px; }
    .history-main { max-width: 70%; }
    .history-date { font-size: 13px; color:#888; }
    .history-delta { font-weight: 600; font-size: 16px; }

    /* Settings */
    .settings-group { margin-bottom: 16px; }
    .settings-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 0;
      border-bottom:1px solid #eee;
      font-size: 15px;
    }
    .settings-label { font-weight: 600; }
    .settings-sub { font-size: 13px; color:#777; margin-top:2px; }
    .settings-btn {
      border-radius:999px;
      border:1px solid #ddd;
      background:#fafafa;
      padding:6px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    /* Quick points */
    .quick-row { display:flex; gap:10px; margin-top:6px; }
    .pill-btn {
      flex:1;
      border-radius:999px;
      border:none;
      padding:8px 4px;
      font-size:15px;
      cursor:pointer;
    }
    .pill-plus { background:#e3f2fd; color:#1565c0; }
    .pill-minus { background:#ffebee; color:#c62828; }
    .small-label { font-size: 13px; color:#777; margin-top:6px; }
    .small-input {
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #ddd;
      margin-top:4px;
      font-size: 15px;
    }

    /* Tabs content */
    .tab-page { display:none; }
    .tab-page.active { display:block; }

    /* Bottom nav */
    nav {
      display:flex;
      justify-content:space-around;
      border-top:1px solid #ddd;
      background:#fff;
    }
    .nav-item {
      flex:1;
      text-align:center;
      padding:10px 0 12px;
      font-size: 14px;
      cursor:pointer;
      color:#777;
    }
    .nav-icon { display:block; font-size: 20px; margin-bottom:2px; }
    .nav-item.active { color:#3366cc; font-weight:600; }
  </style>
</head>
<body>
  <!-- é è¨­å…ˆç”¨ boy ä¸»é¡Œï¼Œä¹‹å¾Œå¯ç”±ç¨‹å¼åˆ‡æ› girl -->
  <div class="app boy">
    <header>
      <div class="header-top">
        <div class="kid-main">
          <div class="avatar">L</div>
          <div>
            <div class="kid-name">Leo</div>
            <div class="kid-sub">ä»Šå¤©ä¸€èµ·åŠ æ²¹ ğŸ’ª</div>
          </div>
        </div>
        <button class="switch-btn" type="button">åˆ‡æ›å°å­© â–¾</button>
      </div>
      <div class="header-bottom">
        <div class="date-chip" id="date-chip">æœ¬é€±ï¼š11 / 18 ï½ 11 / 24</div>
        <div class="total-points" id="total-points">
          <span>â­</span>
          <span>32 é»</span>
        </div>
      </div>
    </header>

    <main>
      <!-- Firebase åŒæ­¥ç‹€æ…‹åˆ—ï¼ˆä¹‹å¾Œå¯ä¾ Firebase å¯¦éš›ç‹€æ…‹åˆ‡æ› classï¼‰ -->
      <div class="sync-bar synced" id="sync-bar" data-status="synced">
        âœ… å·²åŒæ­¥åˆ°é›²ç«¯ï¼ˆFirebaseï¼‰
      </div>

      <!-- æœ¬é€± Tab -->
      <section class="tab-page active" data-tab="today">
        <h2>æœ¬é€±ä»»å‹™è¡¨</h2>
        <div class="week-wrapper">
          <div class="week-table">
            <div class="week-header">
              <div class="task-name-header">ä»»å‹™</div>
              <div class="day-header" data-day-index="0">ä¸€</div>
              <div class="day-header" data-day-index="1">äºŒ</div>
              <div class="day-header" data-day-index="2">ä¸‰</div>
              <div class="day-header" data-day-index="3">å››</div>
              <div class="day-header" data-day-index="4">äº”</div>
              <div class="day-header" data-day-index="5">å…­</div>
              <div class="day-header" data-day-index="6">æ—¥</div>
            </div>

            <div class="day-summary-row">
              <div class="task-name-summary">æœ¬æ—¥å°è¨ˆ</div>
              <div class="day-summary-cell day-summary-cell-positive" data-day-index="0">+0</div>
              <div class="day-summary-cell day-summary-cell-positive" data-day-index="1">+0</div>
              <div class="day-summary-cell day-summary-cell-positive" data-day-index="2">+0</div>
              <div class="day-summary-cell" data-day-index="3">+0</div>
              <div class="day-summary-cell" data-day-index="4">+0</div>
              <div class="day-summary-cell" data-day-index="5">+0</div>
              <div class="day-summary-cell" data-day-index="6">+0</div>
            </div>

            <div class="task-row">
              <div class="task-name">è‡ªå·±ç©¿å¥½è¡£æœ</div>
              <label class="day-cell" data-day-index="0"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="1"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="2"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="3"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="4"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="5"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="6"><input type="checkbox" /></label>
            </div>

            <div class="task-row">
              <div class="task-name">å¯«å®Œå›å®¶ä½œæ¥­</div>
              <label class="day-cell" data-day-index="0"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="1"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="2"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="3"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="4"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="5"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="6"><input type="checkbox" /></label>
            </div>

            <div class="task-row">
              <div class="task-name">ç¡å‰æ”¶ç©å…·</div>
              <label class="day-cell" data-day-index="0"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="1"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="2"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="3"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="4"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="5"><input type="checkbox" /></label>
              <label class="day-cell" data-day-index="6"><input type="checkbox" /></label>
            </div>
          </div>
        </div>

        <h2>å¿«é€ŸåŠ  / æ‰£é»ï¼ˆçˆ¸åª½ï¼‰</h2>
        <div class="card" id="quick-points-card">
          <div class="small-label">èª¿æ•´ä»Šå¤©çš„é»æ•¸ï¼ˆä¹Ÿæœƒå½±éŸ¿ç¸½é»æ•¸ï¼‰</div>
          <div class="quick-row">
            <button class="pill-btn pill-plus" type="button">+1 é»</button>
            <button class="pill-btn pill-minus" type="button">-1 é»</button>
          </div>
          <div class="small-label">å‚™è¨»ï¼ˆé¸å¡«ï¼Œè¨˜éŒ„åŸå› ï¼‰</div>
          <input class="small-input" id="quick-note-input" placeholder="ä¾‹ï¼šä»Šå¤©ä¸»å‹•å¹«å¿™æ”¶ç©å…· +1 é»" />
        </div>
      </section>

      <!-- å…Œæ› Tab -->
      <section class="tab-page" data-tab="rewards">
        <h2>é»æ•¸å…Œæ›</h2>
        <div class="card">
          <div style="font-size:16px; margin-bottom:4px;">
            ç›®å‰å°å­©ï¼š<strong><span id="redeem-kid-name">Leo</span></strong>
          </div>
          <div style="font-size:15px;">
            å¯ç”¨ç¸½é»æ•¸ï¼š<span id="redeem-kid-points" style="font-size:22px;font-weight:800;">32</span> é»
          </div>
          <div style="font-size:13px;color:#777;margin-top:6px;">
            ï¼ˆé€™è£¡é¡¯ç¤ºçš„æ˜¯ç›®å‰é€™ä½å°å­©çš„ç¸½é»æ•¸ï¼Œå…Œæ›æ™‚æœƒå¾é€™è£¡æ‰£é™¤ï¼‰
          </div>
        </div>

        <h2>è¼¸å…¥å…Œæ›å…§å®¹</h2>
        <div class="card">
          <div class="small-label">å…Œæ›åç¨±</div>
          <input class="small-input" placeholder="ä¾‹ï¼šå»çœ‹ç«è»Šã€æ›ä¸€å€‹ç©å…·ã€å¤šçœ‹ 10 åˆ†é˜å¡é€šâ€¦â€¦" />

          <div class="small-label">æ‰£é™¤é»æ•¸</div>
          <input class="small-input" placeholder="ä¾‹ï¼š20" />

          <div class="small-label">å‚™è¨»ï¼ˆé¸å¡«ï¼Œèªªæ˜æˆ–é™åˆ¶æ¢ä»¶ï¼‰</div>
          <input class="small-input" placeholder="ä¾‹ï¼šå‡æ—¥é™å®šã€éœ€è¦çˆ¸åª½å…ˆåŒæ„ï¼ˆç¤ºæ„ï¼‰" />

          <div class="quick-row" style="margin-top:10px;">
            <button class="pill-btn pill-minus" type="button">ç¢ºèªå…Œæ›ï¼ˆç¤ºæ„ï¼‰</button>
          </div>

          <div class="small-label" style="margin-top:8px;">
            ä¹‹å¾Œå¯¦ä½œæ™‚ï¼šæŒ‰ä¸‹ã€Œç¢ºèªå…Œæ›ã€æœƒå¾ Firebase è®€å–ç›®å‰é»æ•¸ â†’ æ‰£é™¤ â†’ å¯«å›ï¼Œä¸¦æ–°å¢ä¸€ç­†å…Œæ›ç´€éŒ„ã€‚
          </div>
        </div>

        <h2>æœ€è¿‘ä¸€æ¬¡å…Œæ›ï¼ˆç¤ºæ„ï¼‰</h2>
        <div class="card">
          <div class="history-item">
            <div class="history-main">
              <div>-20 é»ï¼šå»çœ‹ç«è»Š</div>
              <div class="history-date">2025 / 11 / 23 ä¸‹åˆ Â· ç”±çˆ¸åª½ç¢ºèª</div>
            </div>
            <div class="history-delta" style="color:#c62828;">-20</div>
          </div>
          <div style="font-size:13px;color:#777;">ï¼ˆæœªä¾†æœƒå¾ Firebase è®€å‡ºå¤šç­†å…Œæ›ç´€éŒ„ï¼‰</div>
        </div>
      </section>

      <!-- ç´€éŒ„ Tab -->
      <section class="tab-page" data-tab="history">
        <h2>è¿‘æœŸé»æ•¸ç´€éŒ„</h2>
        <div class="card" id="points-history-card">
          <div class="history-item">
            <div class="history-main">
              <div>+2 é»ï¼šå¯«å®Œå›å®¶ä½œæ¥­</div>
              <div class="history-date">2025 / 11 / 19 æ™šä¸Š</div>
            </div>
            <div class="history-delta" style="color:#4caf50;">+2</div>
          </div>
          <div class="history-item">
            <div class="history-main">
              <div>-1 é»ï¼šæ™šé¤æ™‚åµé¬§ä¸è½æé†’</div>
              <div class="history-date">2025 / 11 / 19 æ™šä¸Š</div>
            </div>
            <div class="history-delta" style="color:#c62828;">-1</div>
          </div>
          <div class="history-item">
            <div class="history-main">
              <div>+3 é»ï¼šä¸»å‹•å¹«å¿™æ”¶æ‹¾å®¢å»³</div>
              <div class="history-date">2025 / 11 / 18 ä¸‹åˆ</div>
            </div>
            <div class="history-delta" style="color:#4caf50;">+3</div>
          </div>
        </div>
      </section>

      <!-- è¨­å®š Tab -->
      <section class="tab-page" data-tab="settings">
        <h2>å°å­©ç®¡ç†</h2>
        <div class="card settings-group">
          <div class="settings-item">
            <div>
              <div class="settings-label">Leo</div>
              <div class="settings-sub">ä»£è¡¨é¡è‰²ï¼šè—è‰² Â· ç¸½é»æ•¸ 32</div>
            </div>
            <button class="settings-btn" type="button">ç·¨è¼¯</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-label">Natasha</div>
              <div class="settings-sub">ä»£è¡¨é¡è‰²ï¼šç²‰è‰² Â· ç¸½é»æ•¸ 18</div>
            </div>
            <button class="settings-btn" type="button">ç·¨è¼¯</button>
          </div>
        </div>

        <h2>ä»»å‹™ç®¡ç†</h2>
        <div class="card settings-group">
          <div class="settings-item">
            <div>
              <div class="settings-label">è‡ªå·±ç©¿å¥½è¡£æœ</div>
              <div class="settings-sub">æ¯å¤©é¡¯ç¤ºåœ¨æœ¬é€±ä»»å‹™è¡¨</div>
            </div>
            <button class="settings-btn" type="button">åˆªé™¤</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-label">å¯«å®Œå›å®¶ä½œæ¥­</div>
              <div class="settings-sub">å¹³æ—¥é¡¯ç¤ºåœ¨æœ¬é€±ä»»å‹™è¡¨</div>
            </div>
            <button class="settings-btn" type="button">åˆªé™¤</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-label">ç¡å‰æ”¶ç©å…·</div>
              <div class="settings-sub">æ¯å¤©é¡¯ç¤ºåœ¨æœ¬é€±ä»»å‹™è¡¨</div>
            </div>
            <button class="settings-btn" type="button">åˆªé™¤</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-label">æ–°å¢ä»»å‹™</div>
              <input class="small-input" placeholder="ä¾‹ï¼šä¸»å‹•å¹«å¿™åšå®¶äº‹ã€é–±è®€ 10 åˆ†é˜â€¦â€¦" />
              <div class="settings-sub">ï¼ˆä¹‹å¾Œå¯¦ä½œæ™‚ï¼šæŒ‰ä¸‹ã€Œæ–°å¢ã€æœƒæŠŠä»»å‹™åŠ å…¥æœ¬é€±ä»»å‹™è¡¨ï¼Œé è¨­æœ‰æ‰“å‹¾æ¡†ä½†ä¸ç›´æ¥çµ¦é»æ•¸ï¼‰</div>
            </div>
            <button class="settings-btn" type="button">æ–°å¢</button>
          </div>
        </div>

        <h2>æ¯æ—¥é»æ•¸è¦å‰‡</h2>
        <div class="card settings-group">
          <div class="small-label">è¨­å®šã€Œä¸€å¤©å®Œæˆå¹¾é …ä»»å‹™ã€æœƒåŠ å¤šå°‘é»ï¼ˆä¸æ˜¯æ¯å€‹ä»»å‹™éƒ½æœ‰è‡ªå·±çš„é»æ•¸ï¼‰ã€‚</div>
          <div class="settings-item">
            <div>
              <div class="settings-label">è¦å‰‡ 1</div>
              <div class="settings-sub">å®Œæˆ â‰§ 1 é …ä»»å‹™ â†’ ç•¶å¤©åŠ  1 é»</div>
            </div>
            <button class="settings-btn" type="button">ç·¨è¼¯</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-label">è¦å‰‡ 2</div>
              <div class="settings-sub">å®Œæˆ â‰§ 3 é …ä»»å‹™ â†’ ç•¶å¤©åŠ  2 é»</div>
            </div>
            <button class="settings-btn" type="button">ç·¨è¼¯</button>
          </div>
          <div class="settings-item">
            <div>
              <div class="settings-label">æ–°å¢è¦å‰‡</div>
              <div style="display:flex; gap:6px; align-items:center; margin-top:4px;">
                <span style="font-size:14px;">å®Œæˆ â‰§</span>
                <input class="small-input" style="max-width:70px;" placeholder="å¹¾é …" />
                <span style="font-size:14px;">é … â†’ åŠ </span>
                <input class="small-input" style="max-width:70px;" placeholder="å¹¾é»" />
                <span style="font-size:14px;">é»</span>
              </div>
              <div class="settings-sub">ï¼ˆä¹‹å¾Œå¯¦ä½œæ™‚ï¼šé€™äº›è¦å‰‡æœƒç”¨ä¾†è¨ˆç®—æœ¬é€±ä»»å‹™è¡¨ä¸Šæ¯ä¸€å¤©çš„ã€Œæœ¬æ—¥å°è¨ˆã€ã€‚ï¼‰</div>
            </div>
            <button class="settings-btn" type="button">æ–°å¢</button>
          </div>
        </div>
      </section>
    </main>

    <nav>
      <div class="nav-item active" data-tab-target="today">
        <span class="nav-icon">ğŸ“…</span>
        æœ¬é€±
      </div>
      <div class="nav-item" data-tab-target="rewards">
        <span class="nav-icon">ğŸ</span>
        å…Œæ›
      </div>
      <div class="nav-item" data-tab-target="history">
        <span class="nav-icon">ğŸ“œ</span>
        ç´€éŒ„
      </div>
      <div class="nav-item" data-tab-target="settings">
        <span class="nav-icon">âš™ï¸</span>
        è¨­å®š
      </div>
    </nav>
  </div>

    <script>
    // ===== ç°¡å–®é ç±¤åˆ‡æ› =====
    var navItems = document.querySelectorAll('.nav-item');
    var pages = document.querySelectorAll('.tab-page');

    navItems.forEach(function(item) {
      item.addEventListener('click', function() {
        var target = item.getAttribute('data-tab-target');

        navItems.forEach(function(n) { n.classList.remove('active'); });
        item.classList.add('active');

        pages.forEach(function(page) {
          if (page.getAttribute('data-tab') === target) {
            page.classList.add('active');
          } else {
            page.classList.remove('active');
          }
        });
      });
    });

    // ===== ç‹€æ…‹å®šç¾©ï¼ˆå…©å€‹å°å­©çš„ç¸½é»æ•¸ï¼‰ =====
    var kidsState = {
      leo: {
        key: 'leo',
        displayName: 'Leo',
        avatar: 'L',
        slogan: 'ä»Šå¤©ä¸€èµ·åŠ æ²¹ ğŸ’ª',
        theme: 'boy',
        totalPoints: 32
      },
      natasha: {
        key: 'natasha',
        displayName: 'Natasha',
        avatar: 'N',
        slogan: 'ä¸€èµ·é–‹å¿ƒç©è€ ğŸŒˆ',
        theme: 'girl',
        totalPoints: 18
      }
    };

    var currentKid = 'leo';

    // ===== DOM åƒç…§ =====
    var appEl = document.querySelector('.app');
    var switchBtn = document.querySelector('.switch-btn');
    var kidNameEl = document.querySelector('.kid-name');
    var avatarEl = document.querySelector('.avatar');
    var kidSubEl = document.querySelector('.kid-sub');
    var totalPointsEl = document.getElementById('total-points');

    var redeemKidNameEl = document.getElementById('redeem-kid-name');
    var redeemKidPointsEl = document.getElementById('redeem-kid-points');

    var quickPlusBtn = document.querySelector('#quick-points-card .pill-plus');
    var quickMinusBtn = document.querySelector('#quick-points-card .pill-minus');
    var quickNoteInput = document.getElementById('quick-note-input');

    var historyCard = document.getElementById('points-history-card');

    // ===== å°å­©åˆ‡æ› + header / å…Œæ›å€æ¸²æŸ“ =====
    function renderCurrentKid() {
      var kid = kidsState[currentKid];
      kidNameEl.textContent = kid.displayName;
      avatarEl.textContent = kid.avatar;
      kidSubEl.textContent = kid.slogan;

      appEl.classList.toggle('boy', kid.theme === 'boy');
      appEl.classList.toggle('girl', kid.theme === 'girl');

      if (totalPointsEl) {
        totalPointsEl.innerHTML = '<span>â­</span><span>' + kid.totalPoints + ' é»</span>';
      }
      if (redeemKidNameEl && redeemKidPointsEl) {
        redeemKidNameEl.textContent = kid.displayName;
        redeemKidPointsEl.textContent = kid.totalPoints;
      }
    }

    if (switchBtn) {
      switchBtn.addEventListener('click', function() {
        currentKid = currentKid === 'leo' ? 'natasha' : 'leo';
        renderCurrentKid();
      });
    }

    // ===== è¨ˆç®—ä»Šå¤©æ˜¯æ˜ŸæœŸå¹¾ï¼ˆå°æ‡‰æ¬„ä½ indexï¼‰ =====
    function getTodayColumnIndex() {
      var today = new Date();
      var jsDay = today.getDay(); // 0=Sun,1=Mon,...6=Sat
      var colIndex;
      switch (jsDay) {
        case 0: colIndex = 6; break; // æ—¥
        case 1: colIndex = 0; break; // ä¸€
        case 2: colIndex = 1; break; // äºŒ
        case 3: colIndex = 2; break; // ä¸‰
        case 4: colIndex = 3; break; // å››
        case 5: colIndex = 4; break; // äº”
        case 6: colIndex = 5; break; // å…­
        default: colIndex = 0;
      }
      return colIndex;
    }

    // ===== è‡ªå‹•æ¨™è¨˜ä»Šå¤©æ˜¯æ˜ŸæœŸå¹¾ & æ²å‹•åˆ°è©²æ¬„ä½ =====
    function highlightTodayColumn() {
      var colIndex = getTodayColumnIndex();
      var selector = '[data-day-index="' + colIndex + '"]';
      var weekTable = document.querySelector('.week-table');
      if (weekTable) {
        weekTable.querySelectorAll(selector).forEach(function(el) {
          el.classList.add('today-col');
        });
      }

      var wrapper = document.querySelector('.week-wrapper');
      var headerCell = document.querySelector('.week-header ' + selector);
      if (wrapper && headerCell) {
        var wrapperRect = wrapper.getBoundingClientRect();
        var cellRect = headerCell.getBoundingClientRect();
        var offset = cellRect.left - wrapperRect.left - (wrapperRect.width / 2) + (cellRect.width / 2);
        wrapper.scrollLeft = wrapper.scrollLeft + offset;
      }
    }

    // ===== æ›´æ–°ã€Œæœ¬æ—¥å°è¨ˆã€ï¼šå’Œå¿«é€ŸåŠ  / æ‰£é»è¯å‹• =====
    function updateTodaySummary(delta) {
      var colIndex = getTodayColumnIndex();
      var selector = '.day-summary-cell[data-day-index="' + colIndex + '"]';
      var targetCell = document.querySelector(selector);
      if (!targetCell) return;

      var text = targetCell.textContent || '';
      var match = text.match(/-?[0-9]+/);
      var value = match ? parseInt(match[0], 10) : 0;
      value = value + delta;

      var sign = value >= 0 ? '+' : '';
      targetCell.textContent = sign + value;
      targetCell.classList.remove('day-summary-cell-positive');
      targetCell.classList.remove('day-summary-cell-negative');
      if (value > 0) targetCell.classList.add('day-summary-cell-positive');
      else if (value < 0) targetCell.classList.add('day-summary-cell-negative');
    }

    // ===== åœ¨ã€Œç´€éŒ„ã€Tab æ–°å¢ä¸€ç­†è¨˜éŒ„ =====
    function appendHistoryItem(delta, reason, fromWhere) {
      if (!historyCard) return;
      var item = document.createElement('div');
      item.className = 'history-item';

      var main = document.createElement('div');
      main.className = 'history-main';

      var descDiv = document.createElement('div');
      var sign = delta > 0 ? '+' : '';
      descDiv.textContent = sign + delta + ' é»ï¼š' + reason;

      var dateDiv = document.createElement('div');
      dateDiv.className = 'history-date';
      var now = new Date();
      var year = now.getFullYear();
      var month = (now.getMonth() + 1).toString().padStart(2, '0');
      var day = now.getDate().toString().padStart(2, '0');
      var hour = now.getHours().toString().padStart(2, '0');
      var minute = now.getMinutes().toString().padStart(2, '0');
      var dateStr = year + ' / ' + month + ' / ' + day + ' ' + hour + ':' + minute;
      var kidName = kidsState[currentKid] ? kidsState[currentKid].displayName : '';
      dateDiv.textContent = dateStr + ' Â· ' + kidName + ' Â· ' + fromWhere;

      main.appendChild(descDiv);
      main.appendChild(dateDiv);

      var deltaDiv = document.createElement('div');
      deltaDiv.className = 'history-delta';
      deltaDiv.textContent = sign + delta;
      deltaDiv.style.color = delta >= 0 ? '#4caf50' : '#c62828';

      item.appendChild(main);
      item.appendChild(deltaDiv);

      historyCard.insertBefore(item, historyCard.firstChild);
    }

    // ===== èª¿æ•´ç¸½é»æ•¸ + è¯å‹•æœ¬æ—¥å°è¨ˆ + è¨˜éŒ„å‚™è¨» =====
    function adjustPoints(delta) {
      var kid = kidsState[currentKid];
      if (!kid) return;

      var oldValue = kid.totalPoints;
      var newValue = oldValue + delta;
      if (newValue < 0) newValue = 0;
      var realDelta = newValue - oldValue;
      if (realDelta === 0) return;
      kid.totalPoints = newValue;

      // æ›´æ–° header / å…Œæ›é é¢çš„é¡¯ç¤º
      renderCurrentKid();

      // æ›´æ–°æœ¬æ—¥å°è¨ˆ
      updateTodaySummary(realDelta);

      // å–å¾—å‚™è¨»
      var note = quickNoteInput ? quickNoteInput.value.trim() : '';
      var reason;
      if (note) reason = note;
      else reason = realDelta > 0 ? 'è‡¨æ™‚åŠ é»' : 'æ‰£é»';

      // æ–°å¢åˆ°ç´€éŒ„ Tab
      appendHistoryItem(realDelta, reason, 'å¿«é€ŸåŠ  / æ‰£é»');

      // æ¸…ç©ºå‚™è¨»è¼¸å…¥æ¡†
      if (quickNoteInput) quickNoteInput.value = '';
    }

    if (quickPlusBtn) {
      quickPlusBtn.addEventListener('click', function() {
        adjustPoints(1);
      });
    }
    if (quickMinusBtn) {
      quickMinusBtn.addEventListener('click', function() {
        adjustPoints(-1);
      });
    }

    // ===== åˆå§‹åŒ– =====
    function init() {
      renderCurrentKid();
      highlightTodayColumn();
    }

    init();
  </script>
</body>
</html>
